---
layout:     post
title:      OpenGL创建窗口基础教程
date:       2025-08-02 
subtitle:   OpenGL 通过GLFW创建窗口
author:     蓝
header-img: img/安和卯.jpg
categories: OpenGL 学习
tags:
  - OpenGL
  - 图形学
---

# OpenGL创建窗口基础教程

## 目录

- [前言](#前言)
- [环境准备](#环境准备)
  - [GLFW](#glfw)
  - [GLAD](#glad)
  - [Linux 环境](#linux-环境)
  - [Windows 环境](#windows-环境)
- [使用 GLFW 创建 OpenGL 窗口的完整流程](#使用-glfw-创建-opengl-窗口的完整流程)
  - [步骤概览](#步骤概览)
  - [示例代码](#示例代码)
  - [效果展示](#效果展示)
- [重点说明与常见易错点](#重点说明与常见易错点)
- [参考](#参考)


> 本文记录如何使用GLFW库在OpenGL中创建一个基础窗口，内容参考自LearningOpenGL的相关章节。

## 前言

OpenGL本身只负责渲染，不负责窗口管理。我们通常借助第三方库（如GLFW）来创建窗口和处理输入。

## 环境准备

### GLFW

GLFW是一个专门针对OpenGL的C语言库，它提供了一些渲染物体所需的最低限度的接口。它允许用户创建OpenGL上下文、定义窗口参数以及处理用户输入

### GLAD

因为OpenGL只是一个标准/规范，具体的实现是由驱动开发商针对特定显卡实现的。由于OpenGL驱动版本众多，它大多数函数的位置都无法在编译时确定下来，需要在运行时查询。所以任务就落在了开发者身上，开发者需要在运行时获取函数地址并将其保存在一个函数指针中供以后使用。

而获取地址的方法非常复杂，而且很繁琐，我们需要对每个可能使用的函数都要重复这个过程，此时GLAD便应运而生，是目前最新，也是最流行的能简化此过程的库。
### Linux 环境

#### 1. 配置 WSL2 Ubuntu 的 OpenGL 环境

首先，需要在 WSL2 的 Ubuntu 中安装必要的编译工具、OpenGL 库以及图形测试工具。

- **安装基础工具和库**  
  打开 WSL2 的 Ubuntu 终端，执行以下命令来安装编译器和必要的 OpenGL 库（包括 GLFW、GLAD、Mesa 等）：

  ```bash
  sudo apt update
  sudo apt install g++ cmake mesa-utils libglfw3-dev libglad-dev libglm-dev libgl1-mesa-dev
  ```

  - `g++` 和 `cmake`：编译 C++ 代码的基础工具。
  - `mesa-utils`：包含 `glxinfo` 和 `glxgears` 等实用工具，用于验证 OpenGL 环境。
  - `libglfw3-dev`：GLFW 库的开发文件，用于创建窗口和处理输入。
  - `libglad-dev`：GLAD 库的开发文件，用于管理 OpenGL 函数指针（推荐使用 GLAD）。
  - `libglm-dev`：GLM 数学库的开发文件。
  - `libgl1-mesa-dev`：Mesa OpenGL 库的开发文件。

- **验证安装**  
  安装完成后，可以通过以下命令验证 OpenGL 环境：

  ```bash
  glxinfo -B
  glxgears
  ```

  - `glxinfo -B`：查看当前的 OpenGL 渲染器信息和版本。
  - `glxgears`：测试基本的 OpenGL 功能（会弹出一个旋转的齿轮窗口）。

#### 2. 设置 X 服务器（用于图形显示）

WSL2 本身不支持原生图形界面，需要借助 Windows 上的 X 服务器来显示 Linux 的图形应用。

- **安装 VcXsrv**  
  在 Windows 上下载并安装 [VcXsrv (XLaunch)](https://sourceforge.net/projects/vcxsrv/)。

- **启动 XLaunch**  
  启动 XLaunch 时，建议勾选 "Native OpenGL" 和 "Disable access control"（禁用访问控制）。

- **配置 WSL2 环境变量**  
  在 WSL2 的 Ubuntu 终端中，编辑 `~/.bashrc` 文件（可用 `nano ~/.bashrc` 或 `vim ~/.bashrc`），在文件末尾添加：

  ```bash
  export DISPLAY=$(grep -oP '(?<=nameserver\s)\d+\.\d+\.\d+\.\d+' /etc/resolv.conf):0.0
  export LIBGL_ALWAYS_INDIRECT=1 # 如遇窗口创建失败，可尝试改为 0
  unset WAYLAND_DISPLAY
  ```

  保存后运行 `source ~/.bashrc` 使设置立即生效。

#### 3. 配置 VSCode 远程连接

- **安装 VSCode 扩展**  
  在 VSCode 扩展市场中搜索并安装 **Remote - WSL** 扩展（Microsoft 官方提供）。

- **连接 WSL2**  
  在 VSCode 左下角点击绿色远程连接按钮，选择 `WSL: Connect to WSL using Distro...`，然后选择你的 Ubuntu 发行版。

- **在 WSL 中打开项目文件夹**  
  可以直接打开 WSL2 文件系统中的文件夹（如 `\\wsl$\Ubuntu-22.04\home\yourname\yourproject`），或打开 Windows 文件系统上的文件夹（挂载在 `/mnt/c/` 等目录下）。

> **注意**：WSL2 支持硬件加速的 OpenGL，但需确保 Windows 端的显卡驱动和 WSL2 图形支持已开启（Windows 11 推荐）。

### Windows 环境
- 安装GLFW库
- 安装GLAD库
- 配置 Visual Studio 环境

#### 步骤如下：

1. 前往 [GLFW 官网](https://www.glfw.org/download.html) 下载 GLFW 库源码，选择 `include` 和 `2015lib` 文件夹（与 TheCherno 教程一致）。  
  ![GLFW 官网页面](/img/GLFW下载网站.png)  
  ![GLFW 下载页面](/img/下载.png)

2. 在 Visual Studio 中创建一个空的 C++ 项目。

3. 在项目目录下新建 `Dependencies` 文件夹，用于存放 GLFW 的头文件和库文件。

4. 配置 Visual Studio 的包含目录：  
  在项目属性的“C/C++” > “常规” > “附加包含目录”中添加 `$(SolutionDir)Dependencies/GLFW/include`，以便项目能够找到 GLFW 的头文件。  
  ![设置包含目录](/img/设置库include路径.png)

5. 配置库目录并链接静态库：  
  在项目属性的“链接器” > “常规” > “附加库目录”中添加 GLFW 的库文件路径，并在“输入” > “附加依赖项”中添加所需的 `.lib` 文件（如 `glfw3.lib`）。  
  ![添加库目录](/img/静态库1.png)  
  ![链接静态库](/img/静态库2.png)

## 使用 GLFW 创建 OpenGL 窗口的完整流程

### 步骤概览

1. 初始化 GLFW 库
2. 配置 OpenGL 版本和窗口属性
3. 创建窗口对象（同时创建 OpenGL 上下文）
4. 使窗口的 OpenGL 上下文成为当前上下文
5. 加载 OpenGL 函数指针（通过 GLAD）
6. 设置视口和回调
7. 进入渲染循环
8. 释放资源并退出

### 示例代码

```cpp
#include <glad/glad.h>
#include <GLFW/glfw3.h>
#include <iostream>

void framebuffer_size_callback(GLFWwindow* window, int width, int height);
void processInput(GLFWwindow* window);

int main()
{
  // 1. 初始化 GLFW
  if (!glfwInit()) {
    std::cout << "Failed to initialize GLFW" << std::endl;
    return -1;
  }

  // 2. 配置 OpenGL 版本和窗口属性
  glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3);
  glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);
  glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);
  // glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE); // MacOS 需要

  // 3. 创建窗口对象（含 OpenGL 上下文）
  GLFWwindow* window = glfwCreateWindow(800, 600, "LearnOpenGL", nullptr, nullptr);
  if (window == nullptr) {
    std::cout << "Failed to create GLFW window" << std::endl;
    glfwTerminate();
    return -1;
  }

  // 4. 使窗口的 OpenGL 上下文成为当前上下文
  glfwMakeContextCurrent(window);

  // 5. 加载 OpenGL 函数指针（GLAD 必须在有上下文后初始化）
  if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress)) {
    std::cout << "Failed to initialize GLAD" << std::endl;
    glfwTerminate();
    return -1;
  }

  // 6. 设置视口和回调
  glViewport(0, 0, 800, 600);
  glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);

  // 7. 渲染循环
  while (!glfwWindowShouldClose(window)) {
    processInput(window);

    // 渲染指令写在这里

    glfwSwapBuffers(window);
    glfwPollEvents();
  }

  // 8. 释放资源
  glfwTerminate();
  return 0;
}

void framebuffer_size_callback(GLFWwindow* window, int width, int height)
{
  glViewport(0, 0, width, height);
}

void processInput(GLFWwindow* window)
{
  if (glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)
    glfwSetWindowShouldClose(window, true);
}
```

### 效果展示

![固定管线渲染，仅供调试](/img/固定管线渲染，仅供调试.png)

---

### 重点说明与常见易错点

- glad.h 的引用需要放在所有引用的**最前面**

- **OpenGL 上下文**
  **OpenGL 的所有操作都依赖于“上下文”**，必须先创建窗口（即上下文）并设为当前，才能调用任何 OpenGL 函数。这就像你必须先打开 Photoshop（创建上下文），然后才能使用它的画笔工具（调用 OpenGL 函数）。

- **GLAD 的作用**
  **GLAD 是 OpenGL 的函数加载器**，必须在拥有当前上下文后初始化，否则无法正确获取函数指针。

- **初始化顺序**

  1. **`glfwInit()`**：初始化库
  2. **`glfwCreateWindow()`**：创建窗口和上下文（但此时还不是当前上下文）
  3. **`glfwMakeContextCurrent()`**：这是​​关键一步​​。它将窗口的 OpenGL 上下文设置为当前线程使用的上下文。从此之后，OpenGL 操作的目标就是这个窗口
  4. **`gladLoadGLLoader()`**：只有在拥有当前上下文之后​​，GLAD 才能通过 `glfwGetProcAddress` 这个函数（它根据当前上下文获取函数地址）成功加载所有 OpenGL 函数的指针

  **顺序错误会导致 OpenGL 函数不可用。**

  > 💡 **小技巧：VS 编译器快捷操作**
  >
  > - **F12 跳转到定义**：在代码中选中函数或变量，按下 `F12` 可以快速跳转到其定义位置，便于追踪源码。
  > - **向下复制一行**：选中一行后，按 `Ctrl+D` 可以快速复制当前行到下一行，提高编辑效率。

## 参考

- [LearningOpenGL - 创建窗口](https://learnopengl-cn.github.io/01%20Getting%20started/03%20Hello%20Window/)
- [LearningOpenGL - 你好，窗口](https://learnopengl-cn.github.io/01%20Getting%20started/03%20Hello%20Window/)
- [GLFW官方文档](https://www.glfw.org/docs/latest/)